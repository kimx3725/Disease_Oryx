---
title: "7.spatial layers simulation"
author: "Dennis Kim"
date: "2024-01-22"
output: html_document
---

# Document Preamble 
```{r preamble, message=FALSE, warning=FALSE}
# load libraries
library(knitr)
library(dplyr)
library(readr)
library(data.table)
library(here)
library(stringr)
library(tidyr)
library(purrr)
library(lubridate)
library(scales)
library(conflicted)

# call environmental data
library(terra)

# analysis
library(momentuHMM)
library(adehabitatLT)

# visualization 
library(ggplot2)

options(width = 150)

conflict_prefer("select", "dplyr")
conflict_prefer("filter", "dplyr")
```

# observed layer 
```{r observed layer}
# observed shrub cover
shrub <- terra::rast("E:/Oryx/data/env_data/shrub/final.shrub.tif")
shrub
plot(shrub)
```

```{r simulated cover}
# aggregate the layer to create a new SpatRaster with a lower resolution - aggregate by 100 cells
sim_shrub <- terra::aggregate(shrub, fact = 100)

# change the values of the shrub layer multiplied by 4 to increase their values 
values(sim_shrub) <- values(sim_shrub)*4 

sim_shrub

plot(sim_shrub)

# save the raster layer 
#writeRaster(sim_shrub, filename = "sim_shrub.tif")
```

# shrub layers
```{r shrub layer}
# observed shrub cover
shrub <- terra::rast("E:/Oryx/data/env_data/shrub/final.shrub.tif")
plot(shrub)

sim_shrub <- terra::rast("E:/Oryx/data/env_data/shrub/sim_shrub.tif")
plot(sim_shrub)
```

```{r observed dataset}
n_oryx <- read_rds(here::here("data/ssf_data", "n_ssf_oryx.rds"))
u_oryx <- read_rds(here::here("data/ssf_data", "u_ssf_oryx.rds"))
i_oryx <- read_rds(here::here("data/ssf_data", "i_ssf_oryx.rds"))

unique(n_oryx$ID) %>% length() # 19 individuals
unique(u_oryx$ID) %>% length() # 25 individuals
unique(i_oryx$ID) %>% length() # 4 individuals

total_oryx <- rbind(n_oryx, u_oryx, i_oryx)
summary(total_oryx)

# get the actual extent where tagged animals are located
min_x <-  total_oryx %>% select(x2_) %>% slice_min(x2_)
min_y <- total_oryx %>% select(y2_) %>% slice_min(y2_)

max_x <- total_oryx %>% select(x2_) %>% slice_max(x2_)
max_y <- total_oryx %>% select(y2_) %>% slice_max(y2_)
```

```{r crop the shrub}
# extent where the observed locations are actually in
crop_extent <- terra::ext(min_x$x2_, max_x$x2_, min_y$y2_, max_y$y2_)

# crop the the current shrub cover to the preferred cropped extent 
cropped_shrub <- terra::crop(shrub, crop_extent)

# save the raster layer 
#writeRaster(cropped_shrub, filename = "cropped_shrub.tif")
```


# Footer
```{r footer}
sessionInfo()
```